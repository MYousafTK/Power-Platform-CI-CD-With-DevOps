<powerpagecomponent powerpagecomponentid="22134143-b5cc-ee11-9079-000d3a69a76f">
  <content>{
  "source": "\r\n&lt;div class=\"container\" style=\"margin:100px\"&gt;\r\n\r\n\r\n{% fetchxml contactList %}\r\n    &lt;fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"&gt;\r\n    &lt;entity name=\"contact\"&gt;\r\n    &lt;attribute name=\"fullname\" /&gt;\r\n    &lt;attribute name=\"telephone1\" /&gt;\r\n    &lt;attribute name=\"emailaddress1\" /&gt;\r\n    &lt;attribute name=\"contactid\" /&gt;\r\n     &lt;attribute name=\"firstname\" /&gt;\r\n    &lt;order attribute=\"fullname\" descending=\"false\" /&gt;\r\n   &lt;!-- &lt;filter type=\"and\"&gt;\r\n      &lt;condition attribute=\"firstname\" operator=\"eq\" value=\"Andrew\" /&gt;\r\n      &lt;condition attribute=\"statecode\" operator=\"eq\" value=\"0\" /&gt;\r\n       &lt;condition attribute=\"emailaddress1\" operator=\"not-null\" /&gt;\r\n    &lt;/filter&gt;--&gt;\r\n  &lt;/entity&gt;\r\n&lt;/fetch&gt;\r\n{% endfetchxmlâ€¯%}\r\n\r\n&lt;div id=\"processingMsg\" class=\"alert alert-warning\" role=\"alert\"&gt;&lt;span class=\"glyphicon glyphicon-info-sign\"&gt; &lt;/span&gt; Power Portal CRUD Operation Using WebApi\r\n\r\n&lt;/div&gt;\r\n&lt;div style=\"float:right;\"&gt;\r\n&lt;button id=\"createContactNew\" class=\"btn btn-info btn-large\" onclick=\"create();\"&gt; &lt;i class=\"glyphicon glyphicon-plus\"&gt;&lt;/i&gt; Create  &lt;/button&gt;\r\n&lt;button id=\"updateContact\" class=\"btn btn-success btn-large\" onclick=\"update('U');\" style=\"margin-left:20px\"&gt; &lt;i class=\"glyphicon glyphicon-inbox\"&gt;&lt;/i&gt; Update &lt;/button&gt;\r\n&lt;button id=\"deleteContact\" value=\"Delete\" class=\"btn btn-danger btn-large \" onclick=\"update('D');\" style=\"margin-left:20px\"&gt; &lt;i class=\"glyphicon glyphicon-trash\"&gt; &lt;/i&gt; Delete &lt;/button&gt;\r\n&lt;button id=\"refreshContact\" value=\"Refresh\" class=\"btn btn-warning btn-large \" onclick=\"javascript:location.reload(true);\" style=\"margin-left:20px\"&gt; &lt;i class=\"glyphicon glyphicon-refresh\"&gt; &lt;/i&gt; Refresh&lt;/button&gt;\r\n&lt;/div&gt;\r\n&lt;table id=\"tblData\" class=\"table\" style=\"border:1px solid\"&gt;\r\n        &lt;thead class=\"thead-dark\"&gt;\r\n            &lt;tr class=\"table-heading\"&gt;\r\n               &lt;th&gt;&lt;input type=\"checkbox\" id=\"checkedAll\" style=\"margin-left:30px\"/&gt;&lt;/th&gt;\r\n                &lt;th&gt;First Name&lt;/th&gt;\r\n                &lt;th&gt;Email&lt;/th&gt;\r\n                &lt;th&gt;Business Phone&lt;/th&gt;\r\n            &lt;/tr&gt;\r\n        &lt;/thead&gt;\r\n        &lt;tbody&gt;\r\n        {% for result in contactList.results.entities %}\r\n       {% assign contactids  = result.contactid %}\r\n        &lt;tr&gt;\r\n            &lt;td&gt;&lt;input type=\"checkbox\" id=\"{{ result.contactid }}\" class=\"contactIDs\" style=\"margin-left:30px\" onchange=\"pushArrayCheckBox(this);\" /&gt;&lt;/td&gt;\r\n            &lt;td&gt;&lt;input type=\"text\" id=\"txtfullName|{{result.contactid}}\" contactid=\"{{result.contactid}}\" value=\"{{ result.firstname }}\" onchange=\"pushArray(this);\"&gt;&lt;/td&gt;\r\n            &lt;td&gt;{{ result[\"emailaddress1\"] }}&lt;/td&gt;\r\n            &lt;td&gt;&lt;input type=\"number\" id=\"txtBusinessPhone|{{result.contactid}}\" contactid=\"{{result.contactid}}\" value=\"{{ result.telephone1 }}\" pattern=\"\\d*\" title=\"Please enter Numbers only...\" onchange=\"pushArray(this);\"&gt;&lt;/td&gt;\r\n          \r\n         &lt;/tr&gt;\r\n          &lt;tr class=\"no-records\" style=\"display: none;\"&gt;\r\n             &lt;td colspan='6'&gt;No Record Found&lt;/td&gt;\r\n         &lt;/tr&gt;\r\n        {% endfor %}\r\n         \r\n    &lt;/tbody&gt;\r\n&lt;/table&gt;\r\n&lt;/div&gt;\r\n&lt;script&gt;\r\n(function(webapi, $) {\r\n    function safeAjax(ajaxOptions) {\r\n        var deferredAjax = $.Deferred();\r\n        shell.getTokenDeferred().done(function(token) {\r\n            // add headers for AJAX                 \r\n            if (!ajaxOptions.headers) {\r\n                $.extend(ajaxOptions, {\r\n                    headers: {\r\n                        \"__RequestVerificationToken\": token\r\n                    }\r\n                });\r\n            } else {\r\n                ajaxOptions.headers[\"__RequestVerificationToken\"] = token;\r\n            }\r\n            $.ajax(ajaxOptions).done(function(data, textStatus, jqXHR) {\r\n                validateLoginSession(data, textStatus, jqXHR, deferredAjax.resolve);\r\n            }).fail(deferredAjax.reject);\r\n            //AJAX             \r\n        }).fail(function() {\r\n            deferredAjax.rejectWith(this, arguments);\r\n            // on token failure pass the token AJAX and args           \r\n        });\r\n        return deferredAjax.promise();\r\n    }\r\n    webapi.safeAjax = safeAjax;\r\n})(window.webapi = window.webapi || {}, jQuery)\r\n\r\n//custom code \r\nvar globalArray = [];\r\n\r\nfunction pushArray(currentObject) {\r\n    var str = currentObject.id;\r\n    var res = str.split(\"|\");\r\n    var contId = res[1];\r\n    var checkbox = document.getElementById(contId).checked;\r\n    var fullname = document.getElementById(\"txtfullName|\" + contId).value;\r\n    var phonenumber = document.getElementById(\"txtBusinessPhone|\" + contId).value;\r\n    let objIndex = globalArray.findIndex((obj =&gt; obj.id == contId));\r\n    if (objIndex == -1) {\r\n        globalArray.push({\r\n            id: contId,\r\n            fullname: fullname,\r\n            phone: phonenumber,\r\n            checkboxval: checkbox\r\n        })\r\n    } else {\r\n        globalArray[objIndex].fullname = fullname;\r\n        globalArray[objIndex].phone = phonenumber;\r\n        globalArray[objIndex].checkboxval = checkbox;\r\n    }\r\n}\r\n\r\nfunction pushArrayCheckBox(currentObject) {\r\n    var contId = currentObject.id;\r\n    var checkbox = document.getElementById(contId).checked;\r\n    var fullname = document.getElementById(\"txtfullName|\" + contId).value;\r\n    var phonenumber = document.getElementById(\"txtBusinessPhone|\" + contId).value;\r\n    let objIndex = globalArray.findIndex((obj =&gt; obj.id == contId));\r\n    if (objIndex == -1) {\r\n        globalArray.push({\r\n            id: contId,\r\n            fullname: fullname,\r\n            phone: phonenumber,\r\n            checkboxval: checkbox\r\n        })\r\n    } else {\r\n        globalArray[objIndex].fullname = fullname;\r\n        globalArray[objIndex].phone = phonenumber;\r\n        globalArray[objIndex].checkboxval = checkbox;\r\n    }\r\n}\r\n\r\nfunction update(flag) {\r\n    var i;\r\n    for (i = 0; i &lt; globalArray.length; i++) { //update checked row changes \r\n        alert(globalArray[i].fullname + \"-\" + globalArray[i].phone + \"-\" + globalArray[i].checkboxval);\r\n        if (globalArray[i].checkboxval == 1) //true\r\n        {\r\n            document.getElementById(\"processingMsg\").innerHTML = \"Processing....\";\r\n            try {\r\n                let value = {\r\n                    \"firstname\": globalArray[i].fullname,\r\n                    \"telephone1\": globalArray[i].phone\r\n                };\r\n                if (flag == \"U\") {\r\n                    webapi.safeAjax({\r\n                        type: \"PATCH\",\r\n                        url: \"/_api/contacts(\" + globalArray[i].id + \")\",\r\n                        contentType: \"application/json\",\r\n                        data: JSON.stringify(value),\r\n                        success: function(res) {\r\n                            document.getElementById(\"processingMsg\").innerHTML = \"Records updated successfully.\";\r\n                        }\r\n                    });\r\n                } else if (flag == \"D\") {\r\n                    webapi.safeAjax({\r\n                        type: \"DELETE\",\r\n                        url: \"/_api/contacts(\" + globalArray[i].id + \")\",\r\n                        contentType: \"application/json\",\r\n                        success: function(res) {\r\n                            document.getElementById(\"processingMsg\").innerHTML = \"Records deleted successfully. Refresh the page.\";\r\n                        }\r\n                    });\r\n                }\r\n            } catch (e) {\r\n                alert(e.message);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction create() {\r\n    var fname = prompt(\"Please enter your first name\", \"First Name\");\r\n    var lname = prompt(\"Please enter your last name\", \"Last Name\");\r\n    var email = prompt(\"Please enter your email\", \"Email\");\r\n    var phone = prompt(\"Please enter your phone number\", \"Phone Number\");\r\n    var recordObj = {\r\n        \"firstname\": fname,\r\n        \"lastname\": lname,\r\n        \"emailaddress1\": email,\r\n        \"telephone1\": phone\r\n    };\r\n    document.getElementById(\"processingMsg\").innerHTML = \"Creating record...\";\r\n    webapi.safeAjax({\r\n        type: \"POST\",\r\n        url: \"/_api/contacts\",\r\n        contentType: \"application/json\",\r\n        data: JSON.stringify(recordObj),\r\n        success: function(res, status, xhr) {\r\n            document.getElementById(\"processingMsg\").innerHTML = \"Records created successfully. Refresh the page. ID:\" + xhr.getResponseHeader(\"entityid\");\r\n        }\r\n    });\r\n}\r\n$(document).ready(function() {\r\n    $('#checkedAll').on('click', function() {\r\n        if (this.checked) {\r\n            $('.contactIDs').each(function() {\r\n                this.checked = true;\r\n                $(this).parent().parent().css({\r\n                    \"color\": \"red\",\r\n                    \"background-color\": \"#faffd6\"\r\n                });\r\n            });\r\n        } else {\r\n            $('.contactIDs').each(function() {\r\n                this.checked = false;\r\n                $(this).parent().parent().css({\r\n                    \"color\": \"black\",\r\n                    \"background-color\": \"#ffffff\"\r\n                });\r\n            });\r\n        }\r\n    });\r\n    $('.contactIDs').on('click', function() {\r\n        if ($('.contactIDs:checked').length == $('.contactIDs').length) {\r\n            $('#checkedAll').prop('checked', true);\r\n            $('.contactIDs').each(function() {\r\n                $(this).parent().parent().css({\r\n                    \"color\": \"red\",\r\n                    \"background-color\": \"#faffd6\"\r\n                });\r\n            });\r\n            $(this).parent().parent().css({\r\n                \"color\": \"black\",\r\n                \"background-color\": \"#ffffff\"\r\n            });\r\n        } else {\r\n            $('#checkedAll').prop('checked', false);\r\n            $(this).parent().parent().css({\r\n                \"color\": \"black\",\r\n                \"background-color\": \"#ffffff\"\r\n            });\r\n        }\r\n    });\r\n});\r\n//abn\r\n&lt;/script&gt;"
}</content>
  <iscustomizable>1</iscustomizable>
  <name>crud</name>
  <powerpagecomponenttype>8</powerpagecomponenttype>
  <powerpagesiteid>
    <powerpagesiteid>6dc36fbc-1f20-4641-8e41-bf3fb5b9a72a</powerpagesiteid>
  </powerpagesiteid>
  <statecode>0</statecode>
  <statuscode>1</statuscode>
</powerpagecomponent>